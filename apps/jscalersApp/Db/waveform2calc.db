
record(subArray, "HPSRF_1")
{
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS11_Sl13_Ch0.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"HPSRF_1N")
}
record(subArray, "HPSRF_2")
{
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS11_Sl13_Ch1.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"HPSRF_2N")
}
record(calc, "HPSRF_1N") {
    field(INPA,"HPSRF_1")
    field(CALC,"A/1000000*80")
}
record(calc, "HPSRF_2N") {
    field(INPA,"HPSRF_2")
    field(CALC,"A/1000000*80")
}
record(subArray, "HPSFCUP")
{
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl2_Ch0.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,3)
    field(FTVL,"DOUBLE")
}
#record(subArray, "HPS:NC:1")
#{
#    field(DTYP,"Soft Channel")
#    field(INP,"B_SCALERSHPS11_Sl3_Ch0.VAL")
#    field(NELM,1)
#    field(MALM,4)
#    field(INDX,3)
#    field(FTVL,"DOUBLE")
#    alias("HPS:NC:frascati")
#}
#record(subArray, "HPS:NC:2")
#{
#    field(DTYP,"Soft Channel")
#    field(INP,"B_SCALERSHPS11_Sl3_Ch1.VAL")
#    field(NELM,1)
#    field(MALM,4)
#    field(INDX,3)
#    field(FTVL,"DOUBLE")
#    alias("HPS:NC:right")
#}
#record(subArray, "HPS:NC:3")
#{
#    field(DTYP,"Soft Channel")
#    field(INP,"B_SCALERSHPS11_Sl3_Ch2.VAL")
#    field(NELM,1)
#    field(MALM,4)
#    field(INDX,3)
#    field(FTVL,"DOUBLE")
#    alias("HPS:NC:left")
#}
#record(subArray, "HPS:NC:4")
#{
#    field(DTYP,"Soft Channel")
#    field(INP,"B_SCALERSHPS11_Sl3_Ch3.VAL")
#    field(NELM,1)
#    field(MALM,4)
#    field(INDX,3)
#    field(FTVL,"DOUBLE")
#    alias("HPS:NC:fwdcar")
#}

record(subArray, "B_HPSECALFADC_TOP_1") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS1_Sl14_Ch3.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_TOP_2") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS1_Sl14_Ch12.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_TOP_3") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS1_Sl15_Ch4.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_TOP_4") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS1_Sl15_Ch12.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_TOP_5") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS1_Sl16_Ch4.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_TOP_6") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS1_Sl16_Ch12.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}

record(subArray, "B_HPSECALFADC_BOT_1") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl14_Ch3.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_BOT_2") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl14_Ch12.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_BOT_3") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl15_Ch4.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_BOT_4") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl15_Ch12.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_BOT_5") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl16_Ch4.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}
record(subArray, "B_HPSECALFADC_BOT_6") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl16_Ch12.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,0)
    field(FTVL,"DOUBLE")
}



# (-1,-1)   1  14   3   7    B_SCALERSHPS11_Sl14_Ch3
# (-3,-2)   2  14   12  2    B_SCALERSHPS11_Sl14_Ch12
# (-5,-2)   2  15   4   3    B_SCALERSHPS11_Sl15_Ch4
# (-7,-2)   2  15   12  4    B_SCALERSHPS11_Sl15_Ch12
# (-9,-2)   2  16   4   5    B_SCALERSHPS11_Sl16_Ch4
# (-11,-1)  2  16   12  6    B_SCALERSHPS11_Sl16_Ch12
# (-1,+1)   1  14   3   7    B_SCALERSHPS12_Sl14_Ch3
# (-3,+2)   1  14   12  8    B_SCALERSHPS12_Sl14_Ch12
# (-5,+2)   1  15   4   9    B_SCALERSHPS12_Sl15_Ch4
# (-7,+2)   1  15   12  10   B_SCALERSHPS12_Sl15_Ch12
# (-9,+2)   1  16   4   11   B_SCALERSHPS12_Sl16_Ch4
# (-11,+1)  1  16   12  12   B_SCALERSHPS12_Sl16_Ch12


# MAIN INPUTS, GATED TRIGGER RATES
# FLINKED FROM jscalers.db
# FLINKED TO FANOUTs
############################################
record(subArray, "HPSTRIGSC_0_GATED") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch0.VAL")
    field(NELM,1)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"HPSTRIGSC_0_FAN")
}
record(subArray, "HPSTRIGSC_1_GATED") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch1.VAL")
    field(NELM,1)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"HPSTRIGSC_1_FAN")
}
record(subArray, "HPSTRIGSC_2_GATED") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch2.VAL")
    field(NELM,1)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"HPSTRIGSC_2_FAN")
}
record(subArray, "HPSTRIGSC_3_GATED") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch3.VAL")
    field(NELM,1)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"HPSTRIGSC_3_FAN")
}
record(subArray, "HPSTRIGSC_4_GATED") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch4.VAL")
    field(NELM,1)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"HPSTRIGSC_4_FAN")
}
record(subArray, "HPSTRIGSC_5_GATED") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch5.VAL")
    field(NELM,1)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"HPSTRIGSC_5_FAN")
}

# FANOUT FROM MAIN INPUTS:
############################################

record(fanout, "HPSTRIGSC_0_FAN") {
    field(LNK1, "HPSTRIGSC_TOTAL")
    field(LNK2, "HPSTRIGSC_0_FRAC")
    field(LNK3, "HPSTRIGSC_0_PRE")
}
record(fanout, "HPSTRIGSC_1_FAN") {
    field(LNK1, "HPSTRIGSC_TOTAL")
    field(LNK2, "HPSTRIGSC_1_FRAC")
    field(LNK3, "HPSTRIGSC_1_PRE")
}
record(fanout, "HPSTRIGSC_2_FAN") {
    field(LNK1, "HPSTRIGSC_TOTAL")
    field(LNK2, "HPSTRIGSC_2_FRAC")
    field(LNK3, "HPSTRIGSC_2_PRE")
}
record(fanout, "HPSTRIGSC_3_FAN") {
    field(LNK1, "HPSTRIGSC_TOTAL")
    field(LNK2, "HPSTRIGSC_3_FRAC")
    field(LNK3, "HPSTRIGSC_3_PRE")
}
record(fanout, "HPSTRIGSC_4_FAN") {
    field(LNK1, "HPSTRIGSC_TOTAL")
    field(LNK2, "HPSTRIGSC_4_FRAC")
    field(LNK3, "HPSTRIGSC_4_PRE")
}
record(fanout, "HPSTRIGSC_5_FAN") {
    field(LNK1, "HPSTRIGSC_TOTAL")
    field(LNK2, "HPSTRIGSC_5_FRAC")
    field(LNK3, "HPSTRIGSC_5_PRE")
    field(LNK4, "HPSTRIGSC_LIVETIME0")
}

# TOTAL GATED RATED, FLINKED FROM FANOUTs:
############################################
record(calc, "HPSTRIGSC_TOTAL") {
    field(INPA,"HPSTRIGSC_0_GATED")
    field(INPB,"HPSTRIGSC_1_GATED")
    field(INPC,"HPSTRIGSC_2_GATED")
    field(INPD,"HPSTRIGSC_3_GATED")
    field(INPE,"HPSTRIGSC_4_GATED")
    field(INPF,"HPSTRIGSC_5_GATED")
    field(CALC,"A+B+C+D+E+F")
}



# COMPUTE RELATIVE RATES, FLINKED FROM FANOUTs:
############################################
record(calc, "HPSTRIGSC_0_FRAC") {
    field(INPA,"HPSTRIGSC_0_GATED")
    field(INPB,"HPSTRIGSC_TOTAL")
    field(CALC,"B>0 ? 100*A/B : -1")
}
record(calc, "HPSTRIGSC_1_FRAC") {
    field(INPA,"HPSTRIGSC_1_GATED")
    field(INPB,"HPSTRIGSC_TOTAL")
    field(CALC,"B>0 ? 100*A/B : -1")
}
record(calc, "HPSTRIGSC_2_FRAC") {
    field(INPA,"HPSTRIGSC_2_GATED")
    field(INPB,"HPSTRIGSC_TOTAL")
    field(CALC,"B>0 ? 100*A/B : -1")
}
record(calc, "HPSTRIGSC_3_FRAC") {
    field(INPA,"HPSTRIGSC_3_GATED")
    field(INPB,"HPSTRIGSC_TOTAL")
    field(CALC,"B>0 ? 100*A/B : -1")
}
record(calc, "HPSTRIGSC_4_FRAC") {
    field(INPA,"HPSTRIGSC_4_GATED")
    field(INPB,"HPSTRIGSC_TOTAL")
    field(CALC,"B>0 ? 100*A/B : -1")
}
record(calc, "HPSTRIGSC_5_FRAC") {
    field(INPA,"HPSTRIGSC_5_GATED")
    field(INPB,"HPSTRIGSC_TOTAL")
    field(CALC,"B>0 ? 100*A/B : -1")
}



# PRESCALED TRIGGER RATES:
# FLINKS to FANOUTS
############################################
record(calc, "HPSTRIGSC_0_PRE") {
    field(INPA,"HPSTRIGSC_0_GATED")
    field(INPB,"HPSTRIGPRESCALE_0")
#field(CALC,"A/(2^B)")
    field(CALC,"B>0 ? A/(2^(B-1)+1) : A")
    field(FLNK,"HPSTRIGSC_0_FAN_PRE")
}
record(calc, "HPSTRIGSC_1_PRE") {
    field(INPA,"HPSTRIGSC_1_GATED")
    field(INPB,"HPSTRIGPRESCALE_1")
#field(CALC,"A/(2^B)")
    field(CALC,"B>0 ? A/(2^(B-1)+1) : A")
    field(FLNK,"HPSTRIGSC_1_FAN_PRE")
}
record(calc, "HPSTRIGSC_2_PRE") {
    field(INPA,"HPSTRIGSC_2_GATED")
    field(INPB,"HPSTRIGPRESCALE_2")
#field(CALC,"A/(2^B)")
    field(CALC,"B>0 ? A/(2^(B-1)+1) : A")
    field(FLNK,"HPSTRIGSC_2_FAN_PRE")
}
record(calc, "HPSTRIGSC_3_PRE") {
    field(INPA,"HPSTRIGSC_3_GATED")
    field(INPB,"HPSTRIGPRESCALE_3")
#field(CALC,"A/(2^B)")
    field(CALC,"B>0 ? A/(2^(B-1)+1) : A")
    field(FLNK,"HPSTRIGSC_3_FAN_PRE")
}
record(calc, "HPSTRIGSC_4_PRE") {
    field(INPA,"HPSTRIGSC_4_GATED")
    field(INPB,"HPSTRIGPRESCALE_4")
#field(CALC,"A/(2^B)")
    field(CALC,"B>0 ? A/(2^(B-1)+1) : A")
    field(FLNK,"HPSTRIGSC_4_FAN_PRE")
}
record(calc, "HPSTRIGSC_5_PRE") {
    field(INPA,"HPSTRIGSC_5_GATED")
    field(INPB,"HPSTRIGPRESCALE_5")
#field(CALC,"A/(2^B)")
    field(CALC,"B>0 ? A/(2^(B-1)+1) : A")
    field(FLNK,"HPSTRIGSC_5_FAN_PRE")
}


# FANOUT TO PRESCALED TOTAL AND FRACTIONS:
############################################
record(fanout, "HPSTRIGSC_0_FAN_PRE") {
    field(LNK1, "HPSTRIGSC_TOTAL_PRE")
    field(LNK2, "HPSTRIGSC_0_FRAC_PRE")
}
record(fanout, "HPSTRIGSC_1_FAN_PRE") {
    field(LNK1, "HPSTRIGSC_TOTAL_PRE")
    field(LNK2, "HPSTRIGSC_1_FRAC_PRE")
}
record(fanout, "HPSTRIGSC_2_FAN_PRE") {
    field(LNK1, "HPSTRIGSC_TOTAL_PRE")
    field(LNK2, "HPSTRIGSC_2_FRAC_PRE")
}
record(fanout, "HPSTRIGSC_3_FAN_PRE") {
    field(LNK1, "HPSTRIGSC_TOTAL_PRE")
    field(LNK2, "HPSTRIGSC_3_FRAC_PRE")
}
record(fanout, "HPSTRIGSC_4_FAN_PRE") {
    field(LNK1, "HPSTRIGSC_TOTAL_PRE")
    field(LNK2, "HPSTRIGSC_4_FRAC_PRE")
}
record(fanout, "HPSTRIGSC_5_FAN_PRE") {
    field(LNK1, "HPSTRIGSC_TOTAL_PRE")
    field(LNK2, "HPSTRIGSC_5_FRAC_PRE")
}


# TOTAL ABSOLUTE PRESCALED RATES, FLINKED FROM FANOUTS:
############################################
record(calc, "HPSTRIGSC_TOTAL_PRE") {
    field(INPA,"HPSTRIGSC_0_PRE")
    field(INPB,"HPSTRIGSC_1_PRE")
    field(INPC,"HPSTRIGSC_2_PRE")
    field(INPD,"HPSTRIGSC_3_PRE")
    field(INPE,"HPSTRIGSC_4_PRE")
    field(INPF,"HPSTRIGSC_5_PRE")
    field(CALC,"A+B+C+D+E+F")
}


# PRESCALED FRACTIONAL RATES, FLINKED FROM FANOUTs:
############################################
record(calc, "HPSTRIGSC_0_FRAC_PRE") {
    field(INPA,"HPSTRIGSC_0_PRE")
    field(INPB,"HPSTRIGSC_TOTAL_PRE")
    field(CALC,"B>0 ? 100*A/B : -1")
    field(FLNK,"HPSTRIGSC_0_SFRAC_PRE")
}
record(calc, "HPSTRIGSC_1_FRAC_PRE") {
    field(INPA,"HPSTRIGSC_1_PRE")
    field(INPB,"HPSTRIGSC_TOTAL_PRE")
    field(CALC,"B>0 ? 100*A/B : -1")
    field(FLNK,"HPSTRIGSC_1_SFRAC_PRE")
}
record(calc, "HPSTRIGSC_2_FRAC_PRE") {
    field(INPA,"HPSTRIGSC_2_PRE")
    field(INPB,"HPSTRIGSC_TOTAL_PRE")
    field(CALC,"B>0 ? 100*A/B : -1")
    field(FLNK,"HPSTRIGSC_2_SFRAC_PRE")
}
record(calc, "HPSTRIGSC_3_FRAC_PRE") {
    field(INPA,"HPSTRIGSC_3_PRE")
    field(INPB,"HPSTRIGSC_TOTAL_PRE")
    field(CALC,"B>0 ? 100*A/B : -1")
    field(FLNK,"HPSTRIGSC_3_SFRAC_PRE")
}
record(calc, "HPSTRIGSC_4_FRAC_PRE") {
    field(INPA,"HPSTRIGSC_4_PRE")
    field(INPB,"HPSTRIGSC_TOTAL_PRE")
    field(CALC,"B>0 ? 100*A/B : -1")
    field(FLNK,"HPSTRIGSC_4_SFRAC_PRE")
}
record(calc, "HPSTRIGSC_5_FRAC_PRE") {
    field(INPA,"HPSTRIGSC_5_PRE")
    field(INPB,"HPSTRIGSC_TOTAL_PRE")
    field(CALC,"B>0 ? 100*A/B : -1")
    field(FLNK,"HPSTRIGSC_5_SFRAC_PRE")
}


# SMOOTHING ONLY, FLINKED FROM FRACTIONAL PRESCALED RATES:
############################################
record(ai, "HPSTRIGSC_0_SFRAC_PRE") {
    field(INP,"HPSTRIGSC_0_FRAC_PRE")
    field(SMOO,0.6)
}
record(ai, "HPSTRIGSC_1_SFRAC_PRE") {
    field(INP,"HPSTRIGSC_1_FRAC_PRE")
    field(SMOO,0.6)
}
record(ai, "HPSTRIGSC_2_SFRAC_PRE") {
    field(INP,"HPSTRIGSC_2_FRAC_PRE")
    field(SMOO,0.6)
}
record(ai, "HPSTRIGSC_3_SFRAC_PRE") {
    field(INP,"HPSTRIGSC_3_FRAC_PRE")
    field(SMOO,0.6)
}
record(ai, "HPSTRIGSC_4_SFRAC_PRE") {
    field(INP,"HPSTRIGSC_4_FRAC_PRE")
    field(SMOO,0.6)
}
record(ai, "HPSTRIGSC_5_SFRAC_PRE") {
    field(INP,"HPSTRIGSC_5_FRAC_PRE")
    field(SMOO,0.6)
}




# DUMMY:
############################################
record(calc, "HPSTRIGSC_TOTAL_FRAC") {
    field(CALC,"100")
    field(SCAN,"10 second")
}

# PRESCALE FACTORS:
############################################
record(ai, "HPSTRIGPRESCALE_0") {
    field(VAL,13)
    field(FLNK,"HPSTRIGSC_0_PRE")
}
record(ai, "HPSTRIGPRESCALE_1") {
    field(VAL,1)
    field(FLNK,"HPSTRIGSC_1_PRE")
}
record(ai, "HPSTRIGPRESCALE_2") {
    field(VAL,6)
    field(FLNK,"HPSTRIGSC_2_PRE")
}
record(ai, "HPSTRIGPRESCALE_3") {
    field(VAL,0)
    field(FLNK,"HPSTRIGSC_3_PRE")
}
record(ai, "HPSTRIGPRESCALE_4") {
    field(VAL,0)
    field(FLNK,"HPSTRIGSC_4_PRE")
}
record(ai, "HPSTRIGPRESCALE_5") {
    field(VAL,0)
    field(FLNK,"HPSTRIGSC_5_PRE")
}



# UNGATED TRIGGER RATES:
####################################################

record(subArray, "HPSTRIGSC_0") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch0.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,3)
    field(FTVL,"DOUBLE")
}
record(subArray, "HPSTRIGSC_1") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch1.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,3)
    field(FTVL,"DOUBLE")
}
record(subArray, "HPSTRIGSC_2") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch2.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,3)
    field(FTVL,"DOUBLE")
}
record(subArray, "HPSTRIGSC_3") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch3.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,3)
    field(FTVL,"DOUBLE")
}
record(subArray, "HPSTRIGSC_4") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch4.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,3)
    field(FTVL,"DOUBLE")
}
record(subArray, "HPSTRIGSC_5") {
    field(DTYP,"Soft Channel")
    field(INP,"B_SCALERSHPS2_Sl10_Ch5.VAL")
    field(NELM,1)
    field(MALM,4)
    field(INDX,3)
    field(FTVL,"DOUBLE")
    field(FLNK, "HPSTRIGSC_LIVETIME0")
}


# LIVETIME, FLINKED FROM HPSTRIGSC_5:
############################################
record(calc, "HPSTRIGSC_LIVETIME0") {
    field(INPA,"HPSTRIGSC_5_GATED")
    field(INPB,"HPSTRIGSC_5 PP")
    field(INPC,"HPSTRIGSC_4 PP")
    field(INPD,"HPSTRIGSC_3 PP")
    field(INPE,"HPSTRIGSC_2 PP")
    field(INPF,"HPSTRIGSC_1 PP")
    field(INPG,"HPSTRIGSC_0 PP")
    field(CALC,"B>0 ? 100*A/B : -999")
    field(FLNK,"HPSTRIGSC_LIVETIME")
}
record(ai, "HPSTRIGSC_LIVETIME") {
    field(INP,"HPSTRIGSC_LIVETIME0")
    field(SMOO,0.6)
    field(LOW,50.0)
    field(LOLO,10.0)
    field(LSV,MINOR)
    field(LLSV,MAJOR)
    field(FLNK,ts_status_ttl)
#field(FLNK,HPSDAQISRUN)
}
#record(calc,"HPSDAQISRUN")
record(calc,"ts_status_ttl")
{
    field(INPA,"HPSTRIGSC_LIVETIME0")
    field(INPB,"HPSTRIGSC_TOTAL")
    field(INPC,"HPSTRIGSC_0_FRAC_PRE")
    field(INPD,"HPSTRIGSC_1_FRAC_PRE")
    field(INPE,"HPSTRIGSC_2_FRAC_PRE")
    field(INPF,"HPSTRIGSC_3_FRAC_PRE")
    field(CALC,"(A<100 | C+D+E+F>0) & A>1 & B>0 ? 1 : 0")
}

############################################
############################################
############################################

# THIS STILL DIDN'T WORK:
#record(calc,"ts_status_ttl2")
#{
#    field(INPA,"ts_status_ttl")
#    field(CALC,"A")
#    field(SCAN,"2 second")
#}
#record(ai,"hallb_run_number2")
#{
#    field(SCAN,"2 second")
#    field(DTYP,"Soft Channel")
#    field(INP,"hallb_run_number")
#}
#record(calc,"hallb_run_status2")
#{
#    field(INPA,"hallb_run_status")
#    field(CALC,"A")
#    field(SCAN,"2 second")
#}
#record(calc,"hallb_livetime2")
#{
#    field(INPA,"hallb_livetime")
#    field(CALC,"A")
#    field(SCAN,"2 second")
#}

# JUST TO FAKE OUT BTA:
grecord( calc,"moller_accumulate")
{
	field(SCAN,"Passive")	
	field(CALC,"1")
	field(PINI, "1")
}


############################################
############################################
############################################

record(calc, "HPSBEAMANGX") {
    field(INPA,"IPM2H01.XPOS")
    field(INPB,"IPM2H02.XPOS")
    field(CALC,"ATAN((B-A)/26/1000)*1000")
    field(SCAN,"2 second")
}
record(calc, "HPSBEAMANGY") {
    field(INPA,"IPM2H01.YPOS")
    field(INPB,"IPM2H02.YPOS")
    field(CALC,"ATAN((B-A)/26/1000)*1000")
    field(SCAN,"2 second")
}

############################################
############################################
############################################

#record(mbbiDirect,"HPS:FSD") {
#       field(DTYP,"Soft Channel")
#       field(NOBT,"16")
#       field(SCAN,"1 second")
#       field(INP,"ISD2H001G")
#       field(FLNK,"HPS:FSD:HALO")
#}
#record(bi, "HPS:FSD:HALO") {
#    field(INP,"HPS:FSD.BA")
#    field(ZNAM,"FSD NOT TRIPPED")
#    field(ONAM,"FSD TRIPPED")
#}

